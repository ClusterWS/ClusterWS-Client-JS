var ClusterWSClient=function(){"use strict";var t;!function(t){t[t.ALL=0]="ALL",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR"}(t||(t={}));var e=function(){function e(t){this.level=t}return e.prototype.debug=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];this.level>t.DEBUG||console.log.apply(console,["[36mdebug:[0m"].concat(e.map(function(t){return"object"==typeof t?JSON.stringify(t):t})))},e.prototype.info=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];this.level>t.INFO||console.log.apply(console,["[32minfo:[0m"].concat(e))},e.prototype.error=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];this.level>t.ERROR||console.log.apply(console,["[31merror:[0m"].concat(e))},e.prototype.warning=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];this.level>t.WARN||console.log.apply(console,["[33mwarning:[0m"].concat(e))},e}();var o=function(){function t(t){this.logger=t,this.events={}}return t.prototype.on=function(t,e){if("function"!=typeof e)return this.logger.error("Listener must be a function");this.events[t]=e},t.prototype.emit=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var n=this.events[t];n&&n.apply(void 0,e)},t.prototype.exist=function(t){return!!this.events[t]},t.prototype.off=function(t){delete this.events[t]},t.prototype.removeEvents=function(){this.events={}},t}(),n=window.MozWebSocket||window.WebSocket,r=new Uint8Array(["A".charCodeAt(0)]).buffer;return function(){function i(n){if(this.reconnectAttempts=0,this.options={url:n.url,autoConnect:!1!==n.autoConnect,autoReconnect:n.autoReconnect||!1,autoResubscribe:!1!==n.autoResubscribe,autoReconnectOptions:{attempts:n.autoReconnectOptions&&n.autoReconnectOptions.attempts||0,minInterval:n.autoReconnectOptions&&n.autoReconnectOptions.minInterval||500,maxInterval:n.autoReconnectOptions&&n.autoReconnectOptions.maxInterval||2e3},logger:n.loggerOptions&&n.loggerOptions.logger?n.loggerOptions.logger:new e(n.loggerOptions&&n.loggerOptions.level||t.ALL)},!this.options.url)return this.options.logger.error("url must be provided");this.emitter=new o(this.options.logger),this.reconnectAttempts=this.options.autoReconnectOptions.attempts,this.options.autoConnect&&this.connect()}return Object.defineProperty(i.prototype,"OPEN",{get:function(){return this.socket.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"CLOSED",{get:function(){return this.socket.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"readyState",{get:function(){return this.socket?this.socket.readyState:0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"binaryType",{get:function(){return this.socket.binaryType},set:function(t){this.socket.binaryType=t},enumerable:!0,configurable:!0}),i.prototype.connect=function(){var t=this;if(console.log("Creating"),this.isCreated)return this.options.logger.error("Connect event has been called multiple times");this.isCreated=!0,this.socket=new n(this.options.url),this.socket.onopen=function(){t.reconnectAttempts=t.options.autoReconnectOptions.attempts},this.socket.onclose=function(e,o){t.isCreated=!1;var n="number"==typeof e?e:e.code,r="number"==typeof e?o:e.reason;if(t.emitter.emit("close",n,r),t.options.autoReconnect&&1e3!==n&&t.readyState===t.CLOSED&&(0===t.options.autoReconnectOptions.attempts||t.reconnectAttempts>0))return t.reconnectAttempts--,setTimeout(function(){t.connect()},Math.floor(Math.random()*(t.options.autoReconnectOptions.maxInterval-t.options.autoReconnectOptions.minInterval+1)));t.emitter.removeEvents()},this.socket.onmessage=function(e){var o=e;e.data&&(o=e.data),t.parsePing(o,function(){if(t.emitter.exist("message"))return t.emitter.emit("message",o);t.processMessage(o)})},this.socket.onerror=function(e){if(t.emitter.exist("error"))return t.emitter.emit("error",e);t.options.logger.error(e),t.close()}},i.prototype.on=function(t,e){this.emitter.on(t,e)},i.prototype.close=function(t,e){this.socket.close(t||1e3,e)},i.prototype.processMessage=function(t){},i.prototype.parsePing=function(t,e){var o=this;if(1===t.size||1===t.byteLength){var n=function(t){return 57===new Uint8Array(t)[0]?(o.socket.send(r),o.emitter.emit("ping")):e()};if(t instanceof Blob){var i=new FileReader;return i.onload=function(t){return n(t.srcElement.result)},i.readAsArrayBuffer(t)}return n(t)}return e()},i}()}();
