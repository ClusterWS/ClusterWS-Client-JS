var ClusterWSClient=function(){"use strict";var e;!function(e){e[e.ALL=0]="ALL",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR"}(e||(e={}));var t=function(){function t(e){this.level=e}return t.prototype.debug=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this.level>e.DEBUG||console.log.apply(console,["[36mdebug:[0m"].concat(t.map(function(e){return"object"==typeof e?JSON.stringify(e):e})))},t.prototype.info=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this.level>e.INFO||console.log.apply(console,["[32minfo:[0m"].concat(t))},t.prototype.error=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this.level>e.ERROR||console.log.apply(console,["[31merror:[0m"].concat(t))},t.prototype.warning=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this.level>e.WARN||console.log.apply(console,["[33mwarning:[0m"].concat(t))},t}();var o=function(){function e(e){this.logger=e,this.events={}}return e.prototype.on=function(e,t){if("function"!=typeof t)return this.logger.error("Listener must be a function");this.events[e]=t},e.prototype.emit=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var n=this.events[e];n&&n.apply(void 0,t)},e.prototype.exist=function(e){return!!this.events[e]},e.prototype.off=function(e){delete this.events[e]},e.prototype.removeEvents=function(){this.events={}},e}(),n=window.MozWebSocket||window.WebSocket,r=new Uint8Array(["A".charCodeAt(0)]).buffer;return function(){function i(n){if(this.options={url:n.url,autoConnect:!1!==n.autoConnect,autoReconnect:n.autoReconnect||!1,autoResubscribe:!1!==n.autoResubscribe,autoReconnectOptions:{},logger:n.loggerOptions&&n.loggerOptions.logger?n.loggerOptions.logger:new t(n.loggerOptions&&n.loggerOptions.level?n.loggerOptions.level:e.ALL)},!this.options.url)return this.options.logger.error("url must be provided");this.emitter=new o(this.options.logger),this.options.autoConnect&&this.connect()}return Object.defineProperty(i.prototype,"readyState",{get:function(){return this.socket?this.socket.readyState:0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"binaryType",{get:function(){return this.socket.binaryType},set:function(e){this.socket.binaryType=e},enumerable:!0,configurable:!0}),i.prototype.connect=function(){var e=this;if(this.isCreated)return this.options.logger.error("Connect event has been called multiple times");this.isCreated=!0,this.socket=new n(this.options.url),this.socket.binaryType="arraybuffer",this.socket.onopen=function(){},this.socket.onclose=function(){},this.socket.onmessage=function(t){var o=t;t.data&&(o=t.data),e.withPing(o,function(){if(e.emitter.exist("message"))return e.emitter.emit("message",o);e.processMessage(o)})},this.socket.onerror=function(t){if(e.emitter.exist("error"))return e.emitter.emit("error",t);e.options.logger.error(t),e.close()}},i.prototype.on=function(e,t){this.emitter.on(e,t)},i.prototype.close=function(e,t){this.socket.close(e||1e3,t)},i.prototype.processMessage=function(e){},i.prototype.withPing=function(e,t){var o=this;if(1===e.size||1===e.byteLength){var n=function(e){return 57===new Uint8Array(e)[0]?(o.socket.send(r),o.emitter.emit("ping")):t()};if(e instanceof Blob){var i=new FileReader;return i.onload=function(e){return n(e.srcElement.result)},i.readAsArrayBuffer(e)}return n(e)}return t()},i}()}();
