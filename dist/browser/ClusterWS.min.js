!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var i in n)("object"==typeof exports?exports:t)[i]=n[i]}}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this.event=t,this.data=e,this.action="emit"}return t}(),o=function(){function t(t,e){this.channel=t,this.data=e,this.action="publish"}return t}(),s=function(){function t(t,e){this.event=t,this.data=e,this.action="internal"}return t}();e.MessageFactory=function(){function t(){}return t.emitMessage=function(t,e){return JSON.stringify(new i(t,e))},t.publishMessage=function(t,e){return JSON.stringify(new o(t,e))},t.internalMessage=function(t,e){return JSON.stringify(new s(t,e))},t}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),o=n(0),s=n(3),r=n(4);e.ClusterWS=function(){function t(t){this.configurations=t,this.channels={},this.missedPing=0,this.inReconnectState=!1,this.reconnectAttempts=0,this.configurations=this.configurations||{},this.options=new r.Options(this.configurations),this.eventEmitter=new s.EventEmitter,this.autoReconnect=this.options.autoReconnect,this._connect()}return t.prototype.on=function(t,e){this.eventEmitter.on(t,e)},t.prototype.send=function(t,e){return this.webSocket.send(o.MessageFactory.emitMessage(t,e))},t.prototype.disconnect=function(t,e){this.webSocket.close(t,e)},t.prototype.subscribe=function(t){return this.channels[t]?this.channels[t]:this.channels[t]=new i.Channel(t,this)},t.prototype._connect=function(){this.webSocket=null,this.webSocket=new WebSocket("ws://"+this.options.url+":"+this.options.port),this._listenOnOpen(),this._listenOnMessage(),this._listenOnError(),this._listenOnClose()},t.prototype._listenOnOpen=function(){var t=this;this.webSocket.onopen=function(e){t.reconnectAttempts=0,t.inReconnectState=!1,clearInterval(t.reconnectInterval),t._resubscribeChannels(),t.eventEmitter.emit("connect",e)}},t.prototype._listenOnMessage=function(){var t=this;this.webSocket.onmessage=function(e){if("_0"===e.data)return t.missedPing=0,t.webSocket.send("_1");try{e=JSON.parse(e.data)}catch(e){return t.disconnect(1007)}switch(e.action){case"emit":t.eventEmitter.emit(e.event,e.data);break;case"publish":t.channels[e.channel]._newMessage(e.data);break;case"internal":"config"===e.event&&(t.pingTimeOut=setInterval(function(){return t.missedPing>2?t.disconnect(3001,"Did not get ping"):t.missedPing++},e.data.pingInterval))}}},t.prototype._listenOnClose=function(){var t=this;this.webSocket.onclose=function(e,n){if(t.eventEmitter.emit("disconnect",e,n),clearInterval(t.pingTimeOut),t.autoReconnect&&1e3!==e)t.inReconnectState||t._reconnect();else{t.eventEmitter.removeAllEvents();for(var i in t.channels)t.channels.hasOwnProperty(i)&&(t.channels[i]=null,delete t.channels[i]);for(var i in t)t.hasOwnProperty(i)&&(t[i]=null,delete t[i])}}},t.prototype._resubscribeChannels=function(){for(var t in this.channels)this.channels.hasOwnProperty(t)&&this.channels[t]._subscribe()},t.prototype._reconnect=function(){var t=this;this.inReconnectState=!0,this.reconnectInterval=setInterval(function(){if(t.webSocket.readyState===t.webSocket.CLOSED&&(t.reconnectAttempts++,t._connect()),0!==t.options.reconnectAttempts&&t.reconnectAttempts>=t.options.reconnectAttempts)return t.autoReconnect=!1,clearInterval(t.reconnectInterval)},this.options.reconnectInterval)},t.prototype._listenOnError=function(){var t=this;this.webSocket.onerror=function(e){t.eventEmitter.emit("error",e)}},t}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0);e.Channel=function(){function t(t,e){this.channel=t,this.client=e,this._subscribe()}return t.prototype.watch=function(t){return this.event=t,this},t.prototype.publish=function(t){return console.log(t),this.client.webSocket.send(i.MessageFactory.publishMessage(this.channel,t)),this},t.prototype._newMessage=function(t){this.event&&this.event(t)},t.prototype._subscribe=function(){this.client.webSocket.send(i.MessageFactory.internalMessage("subscribe",this.channel))},t}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EventEmitter=function(){function t(){this._events={}}return t.prototype.on=function(t,e){if(!e)throw"Function must be provided";if(!this._events[t])return this._events[t]=e},t.prototype.emit=function(t,e,n,i){this._events[t]&&this._events[t](e,n,i)},t.prototype.removeEvent=function(t){this._events[t]&&(this._events[t]=null,delete this._events[t])},t.prototype.removeAllEvents=function(){for(var t in this._events)this._events.hasOwnProperty(t)&&(this._events[t]=null,delete this._events[t])},t.prototype.exist=function(t){return this._events[t]},t}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Options=function(){function t(t){if(!t.url)throw Error("Url must be provided");if(!t.port)throw Error("Port must be provided");this.url=t.url,this.port=t.port,this.autoReconnect=t.autoReconnect||!1,this.reconnectInterval=t.reconnectInterval||1e4,this.reconnectAttempts=t.reconnectAttempts||0}return t}()}])});