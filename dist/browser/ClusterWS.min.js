!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var i in n)("object"==typeof exports?exports:t)[i]=n[i]}}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this.event=t,this.data=e,this.action="emit"}return t}(),o=function(){function t(t,e){this.channel=t,this.data=e,this.action="publish"}return t}(),s=function(){function t(t,e){this.event=t,this.data=e,this.action="internal"}return t}();e.MessageFactory=function(){function t(){}return t.emitMessage=function(t,e){return JSON.stringify(new i(t,e))},t.publishMessage=function(t,e){return JSON.stringify(new o(t,e))},t.internalMessage=function(t,e){return JSON.stringify(new s(t,e))},t}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),o=n(0),s=n(3),r=n(4);e.ClusterWS=function(){function t(t){this.configurations=t,this.missedPing=0,this.configurations=this.configurations||{},this.eventEmitter=new s.EventEmitter,this.channelsEmitter=new s.EventEmitter,this.options=new r.Options(this.configurations),this._connect()}return t.prototype.on=function(t,e){this.eventEmitter.exist(t)||this.eventEmitter.on(t,e)},t.prototype.send=function(t,e){return this.webSocket.send(o.MessageFactory.emitMessage(t,e))},t.prototype.disconnect=function(t,e){this.webSocket.close(t,e)},t.prototype.subscribe=function(t){return new i.Channel(t,this)},t.prototype._connect=function(){var t=this;this.webSocket=new WebSocket("ws://"+this.options.url+":"+this.options.port),console.log(this.webSocket.OPEN),console.log(this.webSocket.CLOSED),console.log(this.webSocket.CONNECTING),setTimeout(function(){console.log(t.webSocket.readyState)},5e3),this._listenOnOpen(),this._lsitenOnMessage(),this._listenOnError(),this._listenOnClose()},t.prototype._listenOnOpen=function(){var t=this;this.webSocket.onopen=function(e){console.log(t.webSocket.readyState),t.eventEmitter.emit("connect",e)}},t.prototype._lsitenOnMessage=function(){var t=this;this.webSocket.onmessage=function(e){if("_0"===e.data)return t.missedPing=0,t.webSocket.send("_1");try{e=JSON.parse(e.data)}catch(e){return t.disconnect(1007)}switch(e.action){case"emit":t.eventEmitter.emit(e.event,e.data);break;case"publish":t.channelsEmitter.emit(e.channel,e.data);break;case"internal":"config"===e.event&&(t.pingTimeOut=setInterval(function(){return t.missedPing>2?t.disconnect(3001,"Did not get ping"):t.missedPing++},e.data.pingInterval))}}},t.prototype._listenOnClose=function(){var t=this;this.webSocket.onclose=function(e,n){t.eventEmitter.emit("disconnect",e,n),clearInterval(t.pingTimeOut),t.eventEmitter.emit("_destroyChannel"),t.eventEmitter.removeAllEvents(),t.channelsEmitter.removeAllEvents();for(var i in t)t.hasOwnProperty(i)&&(t[i]=null,delete t[i])}},t.prototype._listenOnError=function(){var t=this;this.webSocket.onerror=function(e){t.eventEmitter.emit("error",e)}},t}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0);e.Channel=function(){function t(t,e){var n=this;this.channel=t,this.client=e,this.client.webSocket.send(i.MessageFactory.internalMessage("subscribe",this.channel)),this.client.eventEmitter.on("_destroyChannel",function(){for(var t in n)n.hasOwnProperty(t)&&(n[t]=null,delete n[t])})}return t.prototype.watch=function(t){return this.client.channelsEmitter.on(this.channel,t),this},t.prototype.publish=function(t){return this.client.webSocket.send(i.MessageFactory.publishMessage(this.channel,t)),this},t}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EventEmitter=function(){function t(){this._events={}}return t.prototype.on=function(t,e){if(!e)throw"Function must be provided";return this._events[t]||(this._events[t]=[]),this._events[t].push(e)},t.prototype.emit=function(t,e,n,i){if(this._events[t])for(var o=0,s=this._events[t].length;s>o;o++)"function"==typeof this._events[t][o]&&this._events[t][o].call(this,e,n,i)},t.prototype.removeListener=function(t,e){if(this._events[t])for(var n=this._events[t].length;n--;)this._events[t][n]===e&&this._events[t].splice(n,1)},t.prototype.removeEvent=function(t){this._events[t]&&(this._events[t]=null,delete this._events[t])},t.prototype.removeAllEvents=function(){for(var t in this._events)this._events.hasOwnProperty(t)&&(this._events[t]=null,delete this._events[t])},t.prototype.exist=function(t){return this._events[t]},t}()},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Options=function(){function t(t){if(!t.url)throw Error("Url must be provided");if(!t.port)throw Error("Port must be provided");this.url=t.url,this.port=t.port,this.autoReconnect=t.autoReconnect||!1,this.reconnectTime=t.reconnectAttempts||0,this.reconnectAttempts=t.reconnectAttempts||0}return t}()}])});