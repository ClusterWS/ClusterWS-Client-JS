!function(e,n){if("object"==typeof exports&&"object"==typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var t=n();for(var i in t)("object"==typeof exports?exports:e)[i]=t[i]}}(this,function(){return function(e){function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}var t={};return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=1)}([function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,n){this.event=e,this.data=n,this.action="emit"}return e}(),o=function(){function e(e,n){this.channel=e,this.data=n,this.action="publish"}return e}(),r=function(){function e(e,n){this.event=e,this.data=n,this.action="internal"}return e}();n.MessageFactory=function(){function e(){}return e.emitMessage=function(e,n){return JSON.stringify(new i(e,n))},e.publishMessage=function(e,n){return JSON.stringify(new o(e,n))},e.internalMessage=function(e,n){return JSON.stringify(new r(e,n))},e}()},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t(2),o=t(0),r=function(){function e(e,n){if(!e)throw Error("Url must be provided");if(!n)throw Error("Port must be provided");this.url=e,this.port=n}return e}();n.ClusterWS=function(){function e(e){var n=this;this.configurations=e,this.pingPong=0,this.events={},this.channels={},e=e||{},this.options=new r(e.url,e.port),this.webSocket=new WebSocket("ws://"+this.options.url+":"+this.options.port),this.webSocket.onopen=function(e){return n._execEventFn("connect",e)},this.webSocket.onclose=function(e,t){n._execEventFn("disconnect",e,t),clearInterval(n.pingTimeOut);for(var i in n.channels)n.channels.hasOwnProperty(i)&&(n.channels[i]=null,delete n.channels[i]);for(var i in n.events)n.events.hasOwnProperty(i)&&(n.events[i]=null,delete n.events[i]);for(var i in n)n.hasOwnProperty(i)&&(n[i]=null,delete n[i])},this.webSocket.onerror=function(e){return n._execEventFn("error",e)},this.webSocket.onmessage=function(e){return"_0"===e.data?(n.pingPong=0,n.webSocket.send("_1")):(e=JSON.parse(e.data),"emit"===e.action?n._execEventFn(e.event,e.data):"publish"===e.action?n._execChannelFn(e.channel,e.data):"internal"===e.action&&"config"===e.event?void(n.pingTimeOut=setInterval(function(){return 2>n.pingPong?n.pingPong++:n.disconnect(3001,"Did not get ping")},e.data.pingInterval)):void 0)}}return e.prototype._execEventFn=function(e,n,t){var i=this.events[e];if(i)return"disconnect"===e?i(n,t):i(n)},e.prototype._execChannelFn=function(e,n){var t=this.channels[e];t&&t(n)},e.prototype.on=function(e,n){return this.events[e]&&(this.events[e]=null),this.events[e]=n},e.prototype.send=function(e,n){return this.webSocket.send(o.MessageFactory.emitMessage(e,n))},e.prototype.disconnect=function(e,n){this.webSocket.close(e,n)},e.prototype.subscribe=function(e){return new i.Channel(e,this)},e}()},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=t(0);n.Channel=function(){function e(e,n){this.channel=e,this.client=n,this.client.webSocket.send(i.MessageFactory.internalMessage("subscribe",this.channel))}return e.prototype.watch=function(e){return this.client.channels[this.channel]=e,this},e.prototype.publish=function(e){return this.client.webSocket.send(i.MessageFactory.publishMessage(this.channel,e)),this},e}()}])});