!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(this,function(){return function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,n){"use strict";function o(e){e.inReconnectState=!0,e.reconnectInterval=setInterval(function(){if(e.webSocket.readyState===e.webSocket.CLOSED&&(e.reconnectAttempts++,e.connect(),0!==e.options.reconnectAttempts&&e.reconnectAttempts>=e.options.reconnectAttempts))return e.autoReconnect=!1,clearInterval(e.reconnectInterval)},e.options.reconnectInterval)}function i(e){e.reconnectAttempts=0,e.inReconnectState=!1,clearInterval(e.reconnectInterval);for(var t in e.channels)e.channels.hasOwnProperty(t)&&e.channels[t]._subscribe()}Object.defineProperty(t,"__esModule",{value:!0}),t.socketReconnect=o,t.socketSuccessfulReconnection=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),i=n(3),s=n(4),c=n(5),r=n(6),u=n(7),a=n(8),l=n(9);t.ClusterWS=function(){function e(e){this.configurations=e,this.channels={},this.missedPing=0,this.inReconnectState=!1,this.reconnectAttempts=0,this.configurations=this.configurations||{},this.options=new c.Options(this.configurations),this.autoReconnect=this.options.autoReconnect,this.eventEmitter=new s.EventEmitter,this.connect()}return e.prototype.on=function(e,t){this.eventEmitter.on(e,t)},e.prototype.send=function(e,t,n){switch(n){case"pong":this.webSocket.send(e);break;case"internal":this.webSocket.send(i.MessageFactory.internalMessage(e,t));break;case"publish":this.webSocket.send(i.MessageFactory.publishMessage(e,t));break;default:this.webSocket.send(i.MessageFactory.emitMessage(e,t))}},e.prototype.disconnect=function(e,t){this.webSocket.close(e,t)},e.prototype.subscribe=function(e){return this.channels[e]?this.channels[e]:this.channels[e]=new o.Channel(e,this)},e.prototype.connect=function(){this.webSocket=null,this.webSocket=new WebSocket("ws://"+this.options.url+":"+this.options.port),r.socketOpen(this),u.socketMessage(this),a.socketClose(this),l.socketError(this)},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Channel=function(){function e(e,t){this.channel=e,this.client=t,this._subscribe()}return e.prototype.watch=function(e){return this.event=e,this},e.prototype.publish=function(e){return console.log(e),this.client.send(this.channel,e,"publish"),this},e.prototype._message=function(e){this.event&&this.event(e)},e.prototype._subscribe=function(){this.client.send("subscribe",this.channel,"internal")},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){this.event=e,this.data=t,this.action="emit"}return e}(),i=function(){function e(e,t){this.channel=e,this.data=t,this.action="publish"}return e}(),s=function(){function e(e,t){this.event=e,this.data=t,this.action="internal"}return e}();t.MessageFactory=function(){function e(){}return e.emitMessage=function(e,t){return JSON.stringify(new o(e,t))},e.publishMessage=function(e,t){return JSON.stringify(new i(e,t))},e.internalMessage=function(e,t){return JSON.stringify(new s(e,t))},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitter=function(){function e(){this._events={}}return e.prototype.on=function(e,t){if(!t)throw"Function must be provided";if(!this.exist(e))return this._events[e]=t},e.prototype.emit=function(e){for(var t=[],n=1;arguments.length>n;n++)t[n-1]=arguments[n];this.exist(e)&&this._events[e].apply(this,t)},e.prototype.removeEvent=function(e){this.exist(e)&&(this._events[e]=null,delete this._events[e])},e.prototype.removeAllEvents=function(){for(var e in this._events)this._events.hasOwnProperty(e)&&(this._events[e]=null,delete this._events[e])},e.prototype.exist=function(e){return this._events[e]},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Options=function(){function e(e){if(!e.url)throw Error("Url must be provided");if(!e.port)throw Error("Port must be provided");this.url=e.url,this.port=e.port,this.autoReconnect=e.autoReconnect||!1,this.reconnectInterval=e.reconnectInterval||1e4,this.reconnectAttempts=e.reconnectAttempts||0}return e}()},function(e,t,n){"use strict";function o(e){e.webSocket.onopen=function(t){i.socketSuccessfulReconnection(e),e.eventEmitter.emit("connect",t)}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.socketOpen=o},function(e,t,n){"use strict";function o(e){e.webSocket.onmessage=function(t){if("_0"===t.data)return e.missedPing=0,e.send("_1",null,"pong");try{t=JSON.parse(t.data)}catch(t){return e.disconnect(1007)}switch(t.action){case"emit":e.eventEmitter.emit(t.event,t.data);break;case"publish":e.channels[t.channel]._message(t.data);break;case"internal":"config"===t.event&&(e.pingTimeOut=setInterval(function(){return e.missedPing>2?e.disconnect(3001,"Did not get ping"):e.missedPing++},t.data.pingInterval))}}}Object.defineProperty(t,"__esModule",{value:!0}),t.socketMessage=o},function(e,t,n){"use strict";function o(e){e.webSocket.onclose=function(t,n){if(e.eventEmitter.emit("disconnect",t,n),clearInterval(e.pingTimeOut),e.autoReconnect&&1e3!==t)e.inReconnectState||i.socketReconnect(e);else{e.eventEmitter.removeAllEvents();for(var o in e.channels)e.channels.hasOwnProperty(o)&&(e.channels[o]=null,delete e.channels[o]);for(var o in e)e.hasOwnProperty(o)&&(e[o]=null,delete e[o])}}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0);t.socketClose=o},function(e,t,n){"use strict";function o(e){e.webSocket.onerror=function(t){e.eventEmitter.emit("error",t)}}Object.defineProperty(t,"__esModule",{value:!0}),t.socketError=o}])});